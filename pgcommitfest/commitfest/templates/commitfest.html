{%extends "base.html"%}
{%load commitfest %}
{%block contents%}

<div class="accordion" id="filteraccordion">
 <div class="accordion-group">
  <div class="accordion-heading">
    <div class="accordion-toggle" data-toggle="collapse" data-parent="#filteraccordion" href="#collapseFilters" style="padding: 4px;">
      <div class="btn">Filter/search</div>
    </div>
  </div>
  <div id="collapseFilters" class="accordion-body collapse {%if has_filter%}in{%endif%}">
    <form id="filterform" method="GET" action="." style="margin-bottom: 0px">
      <table class="table table-condensed" style="margin-bottom: 0px">
	<thead>
	  <tr>
{%for f in form%}{%if not f.is_hidden%}
            <td>{{f.label}}</td>
{%endif%}{%endfor%}
	    <td></td>
	  </tr>
	</thead>
	<tbody>
	  <tr>
{%for f in form%}
            <td>{{f}}</td>
{%endfor%}
	    <td>
	      <input type="submit" class="btn" value="Filter">
	      <a class="btn" href=".">Clear</a>
	    </td>
	  </tr>
	</tbody>
      </table>
    </form>
  </div>
</div>

{%for p in patches %}
{%ifchanged p.is_open%}
{%if not forloop.first%}
 </tbody>
</table>
{%endif%}
<h3>{{p.is_open|yesno:"Active patches,Closed patches"}}</h3>
<table class="table table-striped table-bordered table-hover table-condensed">
 <thead>
  <tr>
   <th>{%if p.is_open%}<a href="#" style="color:#333333;" onclick="return sortpatches(0);">Patch</a>{%if sortkey = 0%}<div style="float:right;"><i class="icon-arrow-down"></i></div>{%endif%}{%endif%}</th>
   <th>Status</th>
   <th>Author</th>
   <th>Reviewers</th>
   <th>{%if p.is_open%}<a href="#" style="color:#333333;" onclick="return sortpatches(1);">Latest activity</a>{%if sortkey = 1%}<div style="float:right;"><i class="icon-arrow-down"></i></div>{%endif%}{%else%}Latest activity{%endif%}</th>
   <th>{%if p.is_open%}<a href="#" style="color:#333333;" onclick="return sortpatches(2);">Latest mail</a>{%if sortkey = 2%}<div style="float:right;"><i class="icon-arrow-down"></i></div>{%endif%}{%else%}Latest mail{%endif%}</th>
  </tr>
 </thead>
 <tbody>
{%endifchanged%}

{%if grouping%}
{%ifchanged p.topic%}
  <tr><th colspan="6">{{p.topic}}</th></tr>
{%endifchanged%} 
{%endif%}
  <tr>
   <td><a href="{{p.id}}/">{{p}}</a></td>
   <td><span class="label">{{p.status|patchstatusstring}}</span></td>
   <td>{{p.author_names|default:''}}</td>
   <td>{{p.reviewer_names|default:''}}</td>
   <td style="white-space: nowrap;">{{p.modified|date:"Y-m-d"}}<br/>{{p.modified|date:"H:i"}}</td>
   <td style="white-space: nowrap;">{{p.lastmail|date:"Y-m-d"}}<br/>{{p.lastmail|date:"H:i"}}</td>
  </tr>
{%endfor%}
 </tbody>
</table>

{%if cf.isopen or user.is_staff %}
<p>
<a class="btn" href="new/">New patch</a>
</p>
{%endif%}
{%endblock%}
